ext.supportedGradleVersions = ['3.0', '3.1', '3.2', '3.2.1']

sourceSets {
    compatTest
}

gradlePlugin {
    testSourceSets sourceSets.compatTest
}

task compatTest
check.dependsOn compatTest

supportedGradleVersions.each { gradleVersion ->
    def task = tasks.create("compatTest${gradleVersion}", Test) {
        testClassesDir = sourceSets.compatTest.output.classesDir
        classpath = sourceSets.compatTest.runtimeClasspath
        systemProperty 'compat.gradle.version', gradleVersion
    }
    compatTest.dependsOn task
}
